$(function(){function t(e,t){if(e.indexOf("youtube")>-1){e=t}return e}window.location.hash="#voices-"+$("#ibm_cci--toggle-js li a").attr("id");var e=function(e){if(!window.location.hash&&window.location.hash==null){$(location).attr("hash")+"#voices-"+e}else{window.location.hash="#voices-"+e}};$(".ibm_cci--ls--toggle ul.ibm_cci--ls--toggle--ul").children().each(function(){$this=$(this);$this.on("click","a",function(t){t.stopPropagation();var n=$(t.target);if(!n.hasClass("selected")){n.addClass("selected").parent().siblings().children().removeClass("selected");if($("#ibm_cci-widget-js").hasClass("ibm_cci-gv__modifier")){$("#ibm_cci-widget-js").removeClass("ibm_cci-gv__modifier").addClass("ibm_cci-lv__modifier");$(".ibm_cci-lv__modifier .ibm_cci--tweet-content-text").css("display","block");$(".ibm_cci-lv__modifier .ibm-video").css("display","none");$("#ibm_cci-widget-js").masonry("reload")}else{$("#ibm_cci-widget-js").removeClass("ibm_cci-lv__modifier").addClass("ibm_cci-gv__modifier");$(".ibm_cci-gv__modifier .ibm_cci--tweet-content-text").css("display","none");$("#ibm_cci-widget-js").masonry("reloadItems");setTimeout(function(){$("#ibm_cci-widget-js").masonry()},800)}}e(n.attr("id"))})});vo.init_t({tt_url:"https://esl002.somerslab.ibm.com/social/aggregator/rest/80/VOICES/trending",t_template:$("#tt_template"),t_container:$("#ibm_cci__ml")});vo.init_f({f_url:"https://esl002.somerslab.ibm.com/social/aggregator/rest/80/VOICES",f_container:$("#ibm_cci-widget-js"),f_unro_template:$("#unro_template"),f_reso_template:$("#reso_template")});$.when(vo.f_fetch_trending(),vo.f_fetch_feeds()).done(function(e,t){var n=vo;n.f_distribute(t);vo.f_buildtiles();vo.f_removeNodes($("#ibm_cci-widget-js > span"));$("form").on("submit",function(){var e=$("#ibm-cc-search--field").val().toLowerCase();e=e.split(",");console.log(e);for(var t=e.length-1;t>=0;t--){e[t]=e[t].trim()}$("#ibm-cc-search--field").val("");console.log(e);vo.f_constructURL(e.toString())});$("li.ibm_cci__ml_t a[name='all']").on("click",function(e){if($("p#ibm_cci__ml_t-js").hasClass("ibm_cci-clicked")){console.log("return false")}else{$("li.ibm_cci__ml-li p a").removeClass("ibm_cci-close-black, ibm_cci-close");$("li.ibm_cci__ml-li p[class='ibm_cci-clicked']").removeClass("ibm_cci-clicked");$("p#ibm_cci__ml_t-js").addClass("ibm_cci-clicked");$(".ibm_cci--sr > p").addClass("ibm_cci-toggleDisplay");vo.f_removeNodes($(".ibm_cci-tsearch-js"));vo.difference=[];vo.similar=[];vo.searchterms=[];vo.sTerms=[];vo.searchTrendingList=vo.searchTrendingList.slice(0,11);vo.checkedCount=0;vo.f_fetch_feeds().done(function(e){vo.f_removeNodes($("#ibm_cci-widget-js > span"));var t=e;vo.search=true;vo.f_distribute(t);$(".ibm-sortable").append($(".ibm-card")).masonry("appended",$(".ibm-card"));setTimeout(function(){$("#ibm_cci-widget-js").masonry()},400)})}});$(".ibm_cci__ml-li").on("click",function(e){vo.f_addspinner();var t=$(e.target).attr("name").trim(),n=$(e.target).parent();if(!$(n).hasClass("ibm_cci-clicked")){console.log("if triggered");$(e.target).parent("p").addClass("ibm_cci-clicked");$(e.target).siblings("a").addClass("ibm_cci-close");$("#ibm_cci__ml_t-js").removeClass("ibm_cci-clicked");vo.f_constructURL(t.toString())}else if($(n).hasClass("ibm_cci-clicked")){console.log("else if triggered parent has class clicked");console.log("if vo > 0");if(!$(e.target).hasClass("ibm_cci-close-black")){console.log("if target does not have close black");$(e.target).parent("p").removeClass("ibm_cci-clicked");if($(e.target).hasClass("ibm_cci-close")){$(e.target).removeClass("ibm_cci-close")}else{$(e.target).siblings("a").removeClass("ibm_cci-close")}vo.searchterms=$.grep(vo.searchterms,function(e,n){return e!=t||null});vo.difference=[];vo.similar=[];$(".ibm_cci--sr > p").addClass("ibm_cci-toggleDisplay");vo.f_constructURL(vo.searchterms.toString());vo.checkedCount=0}}});$(".ibm_cci__ml").on("click",".ibm_cci__ml-li.ibm_cci-tsearch-js",function(e){if($(e.target).hasClass("ibm_cci-close-black")||$(e.target).hasClass("ibm_cci-voices-search-term")){console.log("if target has close black");var t=$(e.target).attr("name").trim();vo.searchterms=$.grep(vo.searchterms,function(e,n){return e!=t||null});vo.searchTrendingList=$.grep(vo.searchTrendingList,function(e,n){return e!=t||null});$(".ibm_cci--sr > p").addClass("ibm_cci-toggleDisplay");vo.f_removeNodes($(e.target).parent().parent("li.ibm_cci__ml-li.ibm_cci-tsearch-js"));vo.difference=[];vo.similar=[];vo.search=true;vo.f_constructURL(vo.searchterms.toString());vo.checkedCount=0}})});$(window).data("ajaxReq",true).on("scroll",function(e){if($(window).data("ajaxReq")==false)return;console.log($(window).data("ajaxReq"));try{var t=$(document).height()-900;if($(window).scrollTop()+$(window).height()>=$(document).height()-900&&$(window).data("ajaxReq",true)){console.log($(window).scrollTop());console.log($(window).height());console.log($(document).height());$(window).data("ajaxReq",false);console.log("inside scrolltop if "+$(window).data("ajaxReq"));var n=$("#ibm_cci-widget-js .ibm-card").last().attr("data-rank");$.ajax({url:vo.f_url+"?callback=?",type:"GET",contentType:"application/json",dataType:"jsonp",data:{rank:n,noOfItems:20,filter:vo.f_checkSearchstatus(vo.search)},success:function(){console.log("inside success"+$(window).data("ajaxReq"))}}).done(function(e){console.log("success");vo.dataCards=$(".ibm-card");if(e.entries){vo.search=false;vo.f_distribute(e);$(".ibm-sortable").imagesLoaded(function(){console.log("masonry triggered");$(".ibm-sortable").append($(".ibm-card")).masonry("appended",$(".ibm-card"));$(".ibm-sortable").masonry("reload")});setTimeout(function(){if(e.entries.length==20){console.log("if Trriggered");$(window).data("ajaxReq",true)}else{$(window).data("ajaxReq",false)}},3e3)}}).fail(function(){console.log("error")}).always(function(){console.log("complete")})}}catch(e){console.log("infinite all trending scroll error: "+e)}}).on("resize",function(){winHeight=$(window).height()});$.views.helpers({addClass:t})});(function(e,t){var n={searchterms:[],differenceClone:[],searchTrendingList:[],sTerms:[],checkedCount:0,var_rank:0,search:true,init_t:function(e){this.t_url=e.tt_url;this.t_template=e.t_template;this.t_container=e.t_container},t_attach_template:function(e){var t=e;this.t_container.append(this.t_template.render(t))},st_attach_template:function(t){var n=t;this.t_container.append(e("#st_template").render(n))},f_checkSearchstatus:function(e){console.log("inside check searchStatus");try{if(e==true){console.log(e==true);return null}else{return n.searchterms.toString()}}catch(t){console.log("check searchStatus error: "+t)}},f_fetch_trending:function(){var t=this,n=t.t_url;e.getJSON(n+"?callback=?",{type:"GET",dataType:"jsop",contentType:"application/json"},function(n){if(n&&n.trending&&n.trending.indexOf(",")>-1){var r=n.trending.trim()||null;r=e.makeArray(r);t.trendinglist=r[0].split(",")}t.t_newlist=e.map(r[0].split(","),function(t,n){return{t_list:e.makeArray(t)}});t.searchTrendingList=t.trendinglist.slice(0);t.t_attach_template(t.t_newlist)}).promise()},init_f:function(e){this.f_url=e.f_url;this.f_unro_template=e.f_unro_template;this.f_container=e.f_container;this.f_reso_template=e.f_reso_template},f_attach_reso_temp:function(e){this.f_container.append(this.f_reso_template.render(this.f_modify_datafeed(e)))},f_attach_unro_temp:function(e){this.f_container.append(this.f_unro_template.render(this.f_modify_datafeed(e)))},f_modify_datafeed:function(e){var t=this,n=e||null;try{if(n){n.content=this.f_mod_content(n.content||"");n.published=this.f_pretty_date(n.published);if(n.mediaURL||n.altMediaURL||n.userAvatar){n.mediaURL=this.f_preloadImages(n.mediaURL||"");n.altMediaURL=this.f_preloadImages(n.altMediaURL||"")}if(n.refTweets&&n.refTweets.length>0){for(var r=0;r<n.refTweets.length;r++){if(n.refTweets[r].content){n.refTweets[r].content=this.f_mod_content(n.refTweets[r].content||"");n.refTweets[r].published=this.f_pretty_date(n.refTweets[r].published||"")}if(n.userAvatar||n.refTweets.userAvatar){n.userAvatar=this.f_preloadImages(n.userAvatar||"");n.refTweets[r].userAvatar=this.f_preloadImages(n.refTweets[r].userAvatar||"")}}}}return n}catch(i){console.log("Error inside the modify_datafeed"+i)}},f_preloadImages:function(e){var t=new Image;t.src=e;if(t.onerror!==null){console.log("img success "+t.src);return t.src}},f_mod_content:function(e){var t=e.replace(/(http(s)*\:\/\/[^\s]+\s*)/g,'<a href="$1">$1</a>').replace(/#([^\s]+)/g,'<a href="//twitter.com/search?q=%23$1">#$1</a>').replace(/@([^\s:]+)/g,'<a href="//twitter.com/$1">@$1</a>');return t},f_pretty_date:function(e){try{var t=new Array;t[0]="Jan";t[1]="Feb";t[2]="Mar";t[3]="Apr";t[4]="May";t[5]="Jun";t[6]="Jul";t[7]="Aug";t[8]="Sep";t[9]="Oct";t[10]="Nov";t[11]="Dec";t[12]="December";e=e+"";var n=new Date(parseInt(e.trim())||""),r=((new Date).getTime()-n.getTime())/1e3,i=Math.floor(r/86400);if(isNaN(i)||i<0)return;var s=i==0&&(r<60&&"just now"||r<120&&"1m"||r<3600&&Math.floor(r/60)+"m"||r<7200&&"1h"||r<86400&&Math.floor(r/3600)+"h")||i>=1&&i+"d";return s}catch(o){console.log("error inside the f_pretty_data function: "+o)}},f_addspinner:function(){e("#ibm_cci-widget-js").append('<span class="ibm-spinner-small"></span>')},f_fetch_feeds:function(){var t=this,n=t.f_url;t.f_addspinner();return e.ajax({url:n+"?callback=?",type:"GET",contentType:"application/json",dataType:"jsonp",data:{rank:t.var_rank,noOfItems:40,filter:t.searchterms.toString()||null}}).promise()},f_distribute:function(t){console.log("f_distribute triggered");var r=this;r.widgetNodes=e("#ibm_cci-widget-js").children(".ibm-col-1-1");if(n.search){n.f_removeNodes(r.widgetNodes)}try{if(t.entries){r.feed=t.entries;r.feed_length=t.entries.length||0}else{r.feed=t[0].entries;r.feed_length=t[0].entries.length||0}}catch(i){console.log("testing f_distribute"+i)}try{if(r.feed){for(var s=0;s<r.feed_length;s++){if(r.feed[s].type&&r.feed[s].type==="URLREF"){r.f_attach_reso_temp(r.feed[s])}else if(r.feed[s].type&&r.feed[s].type==="TWEET"){r.f_attach_unro_temp(r.feed[s])}}}}catch(i){console.log("Error logged in the DOM ready $.when"+i)}},f_removeNodes:function(e){e.remove()},f_totalSearchCount:function(t){var n=e(".ibm_cci--sr > p");n.text("Results found: "+t).removeClass("ibm_cci-toggleDisplay")},f_buildtiles:function(){var t=e(".ibm-sortable"),n=t.find(".ibm-card");t.imagesLoaded(function(){t.masonry({gutter:0,itemSelector:".ibm-card",transitionDuration:"7s"},true)})},f_appendTrendinglist:function(t){var r=this;r.sTerms=[];r.sTerms.push(t);r.similar=[];r.difference=[];if(n.search){e.grep(r.sTerms[0],function(t,n){if(e.inArray(t,r.searchTrendingList)!==-1){if(r.similar.length==0){r.similar.push(t)}else if(r.similar.length>0){if(e.inArray(t,r.similar)!==-1)return false;if(e.inArray(t,r.similar)===-1)r.similar.push(t)}}else if(e.inArray(t,r.searchTrendingList)===-1){if(r.difference.length==0){r.difference.push(t)}else if(r.difference.length>0){if(e.inArray(t,r.difference)!==-1)return false;if(e.inArray(t,r.difference)===-1)r.difference.push(t)}}});e.grep(r.difference,function(t,n){if(e.inArray(t,r.searchTrendingList)!==-1){return false}else if(e.inArray(t,r.searchTrendingList)===-1){r.searchTrendingList.push(t);r.differenceClone.push(r.difference)}});r.newSearchTermList=e.map(r.difference,function(t,n){return{t_list:e.makeArray(t)}});var i=e(".ibm_cci__ml-li a.ibm_cci-voices-tt-text");try{for(var s=0;s<i.length;s++){for(var o=0;o<r.similar.length;o++){if(r.similar[o]==i[s].text){e(i[s]).parent().addClass("ibm_cci-clicked");e(i[s]).siblings().addClass("ibm_cci-close");if(e("#ibm_cci__ml_t-js").hasClass("ibm_cci-clicked")){e("#ibm_cci__ml_t-js").removeClass("ibm_cci-clicked")}}}}}catch(u){console.log("error in f_appendTrendinglist"+u)}e("#ibm_cci__ml_t-js").removeClass("ibm_cci-clicked");r.st_attach_template(r.newSearchTermList);r.search=false}},f_constructURL:function(t){var r=this;console.log(t);r.filter_searchterms=[];var i=t.trim().split(",");for(var s=0;s<i.length;s++){r.filter_searchterms.push(i[s])}e.grep(r.filter_searchterms,function(t,n){if(e.inArray(t,r.searchterms)===-1)r.searchterms.push(t)});e.unique(r.searchterms);e.ajax(r.f_url+"?callback=?",{type:"GET",dataType:"jsonp",contentType:"application/json",data:{rank:r.var_rank,noOfItems:20,filter:r.searchterms.toString()},success:function(){}}).done(function(t,r,i){var s=n;s.fetchedDataArray=e(window).data("vofeed",t);console.log(s.fetchedDataArray);if(t.terms){if(t.terms.length>0){n.search=true;n.f_distribute(t);n.totalSearchCountNum=t.totalCount||0;n.f_totalSearchCount(t.totalCount);n.f_appendTrendinglist(e.makeArray(t.terms.split(",")));n.checkedCount=t.terms.split(",").length;n.f_removeNodes(e("#ibm_cci-widget-js > span"));e(".ibm-sortable").append(e(".ibm-card")).masonry("appended",e(".ibm-card"));setTimeout(function(){e("#ibm_cci-widget-js").masonry()},400)}else{return}}else{n.f_fetch_feeds().done(function(t){n.f_removeNodes(e("#ibm_cci-widget-js > span"));n.search=true;n.f_distribute(t);e("#ibm_cci__ml_t-js").addClass("ibm_cci-clicked");e("#ibm_cci-widget-js").masonry("reload");setTimeout(function(){e("#ibm_cci-widget-js").masonry()},400)})}}).fail(function(){console.log("error")}).always(function(){})}};t.vo=n})(jQuery,window);(function(e,t,n,r){"use strict";var i=t.event,s;i.special.smartresize={setup:function(){t(this).bind("resize",i.special.smartresize.handler)},teardown:function(){t(this).unbind("resize",i.special.smartresize.handler)},handler:function(e,t){var n=this,r=arguments;e.type="smartresize",s&&clearTimeout(s),s=setTimeout(function(){i.dispatch.apply(n,r)},t==="execAsap"?0:100)}},t.fn.smartresize=function(e){return e?this.bind("smartresize",e):this.trigger("smartresize",["execAsap"])},t.Mason=function(e,n){this.element=t(n),this._create(e),this._init()},t.Mason.settings={isResizable:!0,isAnimated:!1,animationOptions:{queue:!1,duration:500},gutterWidth:0,isRTL:!1,isFitWidth:!1,containerStyle:{position:"relative"}},t.Mason.prototype={_filterFindBricks:function(e){var t=this.options.itemSelector;return t?e.filter(t).add(e.find(t)):e},_getBricks:function(e){var t=this._filterFindBricks(e).css({position:"absolute"}).addClass("masonry-brick");return t},_create:function(n){this.options=t.extend(!0,{},t.Mason.settings,n),this.styleQueue=[];var r=this.element[0].style;this.originalStyle={height:r.height||""};var i=this.options.containerStyle;for(var s in i)this.originalStyle[s]=r[s]||"";this.element.css(i),this.horizontalDirection=this.options.isRTL?"right":"left";var o=this.element.css("padding-"+this.horizontalDirection),u=this.element.css("padding-top");this.offset={x:o?parseInt(o,10):0,y:u?parseInt(u,10):0},this.isFluid=this.options.columnWidth&&typeof this.options.columnWidth=="function";var a=this;setTimeout(function(){a.element.addClass("masonry")},0),this.options.isResizable&&t(e).bind("smartresize.masonry",function(){a.resize()}),this.reloadItems()},_init:function(e){this._getColumns(),this._reLayout(e)},option:function(e,n){t.isPlainObject(e)&&(this.options=t.extend(!0,this.options,e))},layout:function(e,t){for(var n=0,r=e.length;n<r;n++)this._placeBrick(e[n]);var i={};i.height=Math.max.apply(Math,this.colYs);if(this.options.isFitWidth){var s=0;n=this.cols;while(--n){if(this.colYs[n]!==0)break;s++}i.width=(this.cols-s)*this.columnWidth-this.options.gutterWidth}this.styleQueue.push({$el:this.element,style:i});var o=this.isLaidOut?this.options.isAnimated?"animate":"css":"css",u=this.options.animationOptions,a;for(n=0,r=this.styleQueue.length;n<r;n++)a=this.styleQueue[n],a.$el[o](a.style,u);this.styleQueue=[],t&&t.call(e),this.isLaidOut=!0},_getColumns:function(){var e=this.options.isFitWidth?this.element.parent():this.element,t=e.width();this.columnWidth=this.isFluid?this.options.columnWidth(t):this.options.columnWidth||this.$bricks.outerWidth(!0)||t,this.columnWidth+=this.options.gutterWidth,this.cols=Math.floor((t+this.options.gutterWidth)/this.columnWidth),this.cols=Math.max(this.cols,1)},_placeBrick:function(e){var n=t(e),r,i,s,o,u;r=Math.ceil(n.outerWidth(!0)/this.columnWidth),r=Math.min(r,this.cols);if(r===1)s=this.colYs;else{i=this.cols+1-r,s=[];for(u=0;u<i;u++)o=this.colYs.slice(u,u+r),s[u]=Math.max.apply(Math,o)}var a=Math.min.apply(Math,s),f=0;for(var l=0,c=s.length;l<c;l++)if(s[l]===a){f=l;break}var h={top:a+this.offset.y};h[this.horizontalDirection]=this.columnWidth*f+this.offset.x,this.styleQueue.push({$el:n,style:h});var p=a+n.outerHeight(!0),d=this.cols+1-c;for(l=0;l<d;l++)this.colYs[f+l]=p},resize:function(){var e=this.cols;this._getColumns(),(this.isFluid||this.cols!==e)&&this._reLayout()},_reLayout:function(e){var t=this.cols;this.colYs=[];while(t--)this.colYs.push(0);this.layout(this.$bricks,e)},reloadItems:function(){this.$bricks=this._getBricks(this.element.children())},reload:function(e){this.reloadItems(),this._init(e)},appended:function(e,t,n){if(t){this._filterFindBricks(e).css({top:this.element.height()});var r=this;setTimeout(function(){r._appended(e,n)},1)}else this._appended(e,n)},_appended:function(e,t){var n=this._getBricks(e);this.$bricks=this.$bricks.add(n),this.layout(n,t)},remove:function(e){this.$bricks=this.$bricks.not(e),e.remove()},destroy:function(){this.$bricks.removeClass("masonry-brick").each(function(){this.style.position="",this.style.top="",this.style.left=""});var n=this.element[0].style;for(var r in this.originalStyle)n[r]=this.originalStyle[r];this.element.unbind(".masonry").removeClass("masonry").removeData("masonry"),t(e).unbind(".masonry")}},t.fn.imagesLoaded=function(e){function n(){e.call(i,s)}function r(e){var i=e.target;i.src!==u&&t.inArray(i,a)===-1&&(a.push(i),--o<=0&&(setTimeout(n),s.unbind(".imagesLoaded",r)))}var i=this,s=i.find("img").add(i.filter("img")),o=s.length,u="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",a=[];return o||n(),s.bind("load.imagesLoaded error.imagesLoaded",r).each(function(){var e=this.src;this.src=u,this.src=e}),i};var o=function(t){e.console&&e.console.error(t)};t.fn.masonry=function(e){if(typeof e=="string"){var n=Array.prototype.slice.call(arguments,1);this.each(function(){var r=t.data(this,"masonry");if(!r){o("cannot call methods on masonry prior to initialization; attempted to call method '"+e+"'");return}if(!t.isFunction(r[e])||e.charAt(0)==="_"){o("no such method '"+e+"' for masonry instance");return}r[e].apply(r,n)})}else this.each(function(){var n=t.data(this,"masonry");n?(n.option(e||{}),n._init()):t.data(this,"masonry",new t.Mason(e,this))});return this}})(window,jQuery,vo)