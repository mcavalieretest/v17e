$(function(){function e(e,t){return e.indexOf("youtube")>-1&&(e=t),e}function t(e){var t="";return t=e.length>172?e.substring(0,170):e}window.location.hash="#voices-"+$("#ibm_cci--toggle-js li a").attr("id");var i="comma,separated,values",s=$(".ibm_cci--ls--search p"),a=$("#ibm_cci-gototop-js"),n=$("#ibm_cci-widget-js"),r=function(e){window.location.hash||null!=window.location.hash?window.location.hash="#voices-"+e:$(location).attr("hash")+"#voices-"+e};a.on("click",function(e){console.log("inside gototop action: "+a),e.preventDefault(),$("html, body").stop(!0).animate({scrollTop:0},"slow")}),$("ul.ibm_cci--ls--toggle--ul li").on("click","a",function(e){e.preventDefault();var t=$(e.target);t.hasClass("selected")||(t.addClass("selected").parent().siblings().children().removeClass("selected"),n.hasClass("ibm_cci-gv__modifier")?(n.removeClass("ibm_cci-gv__modifier").addClass("ibm_cci-lv__modifier"),$(".ibm_cci-lv__modifier .ibm_cci--tweet-content-text").css("display","block"),$(".ibm_cci-lv__modifier .ibm-video").css("display","none"),vo.f_checkBrowserWidth(),n.masonry("reload"),setTimeout(function(){n.masonry("reloadItems")},800)):(n.removeClass("ibm_cci-lv__modifier").addClass("ibm_cci-gv__modifier"),$(".ibm_cci-gv__modifier .ibm_cci--tweet-content-text").css("display","none"),$(".ibm_cci-gv__modifier .ibm-video").removeAttr("style"),vo.f_checkBrowserWidth(),n.masonry("reloadItems"),setTimeout(function(){n.masonry({fromBottom:!0})},800))),r(t.attr("id")),"#voices-list"===window.location.hash&&window.innerWidth>1280?($("#ibm_cci-widget-js.ibm-columns").css("width",""),n.masonry("reload")):"#voices-grid"===window.location.hash&&window.innerWidth>1280&&$("#ibm_cci-widget-js.ibm-columns").css("width","auto")}),vo.init_t({tt_url:"https://esl002.somerslab.ibm.com/social/aggregator/rest/80/VOICES/trending",t_template:$("#tt_template"),t_container:$("#ibm_cci__ml")}),vo.init_f({f_url:"https://esl002.somerslab.ibm.com/social/aggregator/rest/80/VOICES",f_container:$("#ibm_cci-widget-js"),f_unro_template:$("#unro_template"),f_reso_template:$("#reso_template")}),$.when(vo.f_fetch_trending(),vo.f_fetch_feeds()).done(function(e,t){var a=vo;a.f_checkBrowserWidth(),a.f_distribute(t[0]),a.f_buildtiles(),a.f_removeNodes($("#ibm_cci-widget-js > span")),$("#ibm-cc-search--field").focusin(function(e){e.preventDefault(),$(".ibm_cci--ls--search p").removeClass("ibm-cci-alert").html(""),$(this).val("")}),$("form").on("submit",function(){var e=$("#ibm-cc-search--field"),t=/^[a-zA-Z0-9 ]*$/,a=$("#ibm-cc-search--field").val().toLowerCase();if(a=a.split(","),filterVal=[],""!=a&&0!=a.length&&"comma"!=a[0])for(var n=a.length-1;n>=0;n--)t.test(a[n])?filterVal[n]=a[n].trim():(s.addClass("ibm-cci-alert").html("").append("illegal characters in search string : "+a[n]),e.val("").blur());else $(".ibm_cci--ls--search p").addClass("ibm-cci-alert").html("").append("Sorry! Search value entered is not valid!"),e.blur().val(i);e.val(""),""!=filterVal&&0!=filterVal&&filterVal.length>0&&vo.f_constructURL(filterVal.toString())}),$("li.ibm_cci__ml_t a[name='all']").on("click",function(e){return e.preventDefault(),$("p#ibm_cci__ml_t-js").hasClass("ibm_cci-clicked")?void e.preventDefault():($("li.ibm_cci__ml-li p a").removeClass("ibm_cci-close-black, ibm_cci-close"),$("li.ibm_cci__ml-li p[class='ibm_cci-clicked']").removeClass("ibm_cci-clicked"),$("p#ibm_cci__ml_t-js").addClass("ibm_cci-clicked"),$(".ibm_cci--sr > p").addClass("ibm_cci-toggleDisplay"),vo.f_removeNodes($(".ibm_cci-tsearch-js")),vo.difference=[],vo.similar=[],vo.searchterms=[],vo.sTerms=[],vo.checkedCount=0,vo.searchTrendingList=vo.searchTrendingList.slice(0,11),vo.f_fetch_feeds().done(function(e){vo.f_removeNodes($("#ibm_cci-widget-js > span"));var t=e;vo.search=!0,vo.totalSearchCountNum=t.entries.length,vo.f_distribute(t),vo.f_reTweetToggle(),$(".ibm-sortable").append($(".ibm-card")).masonry("appended",$(".ibm-card")),setTimeout(function(){$("#ibm_cci-widget-js").masonry()},400),0==vo.searchterms.length&&$(window).data("ajaxReq",!0),s.html("")}),void 0)}),$(".ibm_cci__ml-li").on("click",function(e){e.preventDefault();var t=$(e.target).attr("name").trim(),i=$(e.target).parent();$(i).hasClass("ibm_cci-clicked")?$(i).hasClass("ibm_cci-clicked")&&($(e.target).hasClass("ibm_cci-close-black")||($(e.target).parent("p").removeClass("ibm_cci-clicked"),$(e.target).hasClass("ibm_cci-close")?$(e.target).removeClass("ibm_cci-close"):$(e.target).siblings("a").removeClass("ibm_cci-close"),vo.searchterms=$.grep(vo.searchterms,function(e){return e!=t}),vo.difference=[],vo.similar=[],$(".ibm_cci--sr > p").addClass("ibm_cci-toggleDisplay"),vo.f_constructURL(vo.searchterms.toString()),s.html(""))):($(e.target).parent("p").addClass("ibm_cci-clicked"),$(e.target).siblings("a").addClass("ibm_cci-close"),$("#ibm_cci__ml_t-js").removeClass("ibm_cci-clicked"),vo.f_constructURL(t.toString()),s.html(""))}),$(".ibm_cci__ml").on("click",".ibm_cci__ml-li.ibm_cci-tsearch-js",function(e){if(e.preventDefault(),$(e.target).hasClass("ibm_cci-close-black")||$(e.target).hasClass("ibm_cci-voices-search-term")){var t=$(e.target).attr("name").trim();vo.searchterms=$.grep(vo.searchterms,function(e){return e!=t||null}),vo.searchTrendingList=$.grep(vo.searchTrendingList,function(e){return e!=t||null}),$(".ibm_cci--sr > p").addClass("ibm_cci-toggleDisplay"),vo.f_removeNodes($(e.target).parent().parent("li.ibm_cci__ml-li.ibm_cci-tsearch-js")),vo.difference=[],vo.similar=[],vo.search=!0,vo.f_constructURL(vo.searchterms.toString()),vo.checkedCount=0,s.html("")}}),a.f_reTweetToggle(),a.f_checkBrowserWidth()}),$(window).data("ajaxReq",!0).on("scroll",function(e){e.preventDefault();var t=$("#ibm_cci-widget-js .ibm-card").last().attr("data-rank");if(!(0==$(window).data("ajaxReq")||vo.totalSearchCountNum<20||20>t))try{$(a).css($(window).scrollTop()<400?{opacity:0,visibility:"hidden"}:{opacity:1,visibility:"visible"}),$(window).scrollTop()+$(window).height()>=$(document).height()+72-900&&$(window).data("ajaxReq",!0)&&($(window).data("ajaxReq",!1),(t>=20||vo.totalSearchCountNum>=20)&&$.ajax({url:vo.f_url+"?callback=?",type:"GET",contentType:"application/json",dataType:"jsonp",data:{rank:t,noOfItems:20,filter:vo.f_checkSearchstatus(vo.search)},success:function(){}}).done(function(e){vo.dataCards=$(".ibm-card"),e.entries&&(vo.search=!1,vo.f_distribute(e),vo.f_reTweetToggle(),$(".ibm-sortable").imagesLoaded(function(){$(".ibm-sortable").append($(".ibm-card")).masonry("appended",$(".ibm-card")),$(".ibm-sortable").masonry("reload")}),setTimeout(function(){e.entries.length>=20?$(window).data("ajaxReq",!0):$(window).data("ajaxReq",!1)},800))}).fail(function(){}).always(function(){}))}catch(i){console.log("infinite all trending scroll error: "+i)}}).on("resize",function(){$(window).height();ibmsortable=$(".ibm-sortable"),($(window).width()<=500||$(window).width()<=800)&&(ibmsortable.imagesLoaded(function(){ibmsortable.append($(".ibm-card")).masonry("appended",$(".ibm-card")),ibmsortable.masonry("reload")}),vo.f_removeNodes($("#ibm_cci-widget-js > span"))),$(window).width()<=500&&$("#ibm_cci-widget-js").hasClass("ibm_cci-lv__modifier")&&($("#ibm_cci-widget-js").removeClass("ibm_cci-lv__modifier").addClass("ibm_cci-gv__modifier"),$(".ibm_cci--ls--toggle--li--list-icon a").removeClass("selected"),$(".ibm_cci--ls--toggle--li--grid-icon a").addClass("selected"),vo.f_removeNodes($("#ibm_cci-widget-js > span"))),vo.f_checkBrowserWidth(),"#voices-list"===window.location.hash&&window.innerWidth>1280?($("#ibm_cci-widget-js.ibm-columns").css("width",""),n.masonry("reload")):"#voices-grid"===window.location.hash&&window.innerWidth>1280?$("#ibm_cci-widget-js.ibm-columns").css("width","auto"):"#voices-grid"===window.location.hash&&window.innerWidth<1280&&($("#ibm_cci-widget-js.ibm-columns").css("width",""),$("#ibm_cci-widget-js.ibm-columns").css("margin-left",""),n.masonry("reload"))}),$.views.helpers({mediaURL:e,truncateDesc:t})}),function(e,t){var i={searchterms:[],differenceClone:[],searchTrendingList:[],sTerms:[],checkedCount:0,var_rank:0,search:!0,init_t:function(e){this.t_url=e.tt_url,this.t_template=e.t_template,this.t_container=e.t_container},init_f:function(e){this.f_url=e.f_url,this.f_unro_template=e.f_unro_template,this.f_container=e.f_container,this.f_reso_template=e.f_reso_template},t_attach_template:function(e){var t=e;this.t_container.append(this.t_template.render(t))},st_attach_template:function(t){var i=t;this.t_container.append(e("#st_template").render(i))},f_fetch_trending:function(){var t=this,i=t.t_url;e.getJSON(i+"?callback=?",{type:"GET",dataType:"jsop",contentType:"application/json"},function(i){if(i&&i.trending&&i.trending.indexOf(",")>-1){var s=i.trending.trim()||null;s=e.makeArray(s),t.trendinglist=s[0].split(",")}t.t_newlist=e.map(s[0].split(","),function(t){return{t_list:e.makeArray(t)}}),t.searchTrendingList=t.trendinglist.slice(0),t.t_attach_template(t.t_newlist)}).promise()},f_fetch_feeds:function(){var t=this,i=t.f_url;return t.f_addspinner(),e.ajax({url:i+"?callback=?",type:"GET",contentType:"application/json",dataType:"jsonp",data:{rank:t.var_rank,noOfItems:20,filter:t.searchterms.toString()||null}}).promise()},f_attach_reso_temp:function(e){this.f_container.append(this.f_reso_template.render(this.f_modify_datafeed(e)))},f_attach_unro_temp:function(e){this.f_container.append(this.f_unro_template.render(this.f_modify_datafeed(e)))},f_modify_datafeed:function(t){var i=t||null;try{if(""==i||void 0==i){var s=e(".ibm_cci--sr p");s.append("Data not available")}if(i&&(i.rank=this.f_mod_rank(i.rank||""),i.content=this.f_mod_content(i.content||""),i.published=this.f_pretty_date(i.published||""),i.domain=this.f_truncateDomain(i.domain||""),(i.mediaURL||i.altMediaURL)&&(i.mediaURL=this.f_preloadImages(i.mediaURL||""),i.altMediaURL=this.f_preloadImages(i.altMediaURL||"")),i.refTweets&&i.refTweets.length>0))for(var a=0;a<i.refTweets.length;a++)i.refTweets[a].content&&(i.refTweets[a].content=this.f_mod_content(i.refTweets[a].content||""),i.refTweets[a].published=this.f_pretty_date(i.refTweets[a].published||"")),(i.userAvatar||i.refTweets.userAvatar)&&(i.userAvatar=this.f_preloadImages(i.userAvatar||""),i.refTweets[a].userAvatar=this.f_preloadImages(i.refTweets[a].userAvatar||""));return i}catch(n){console.log("Error inside the modify_datafeed: "+n)}},f_mod_rank:function(e){var t=0;return t=10>e?"0"+e:e},f_preloadImages:function(e){var t=new Image,i=/\.(jpeg|jpg|gif|png|ico|jpg:large)$/,s=0;t.src=e;try{if(e.indexOf("youtube")>-1)return e;if(null!=e.match(i)&&4!=t.src.readyState)return t.onload=function(){s=t.naturalWidth},t.src}catch(a){console.log("error inside preload images: "+a)}},f_truncateDomain:function(e){return e.indexOf(".com")>-1&&(e=e.replace(".com","")),e.indexOf("www.")>-1&&(e=e.replace("www.","")),e.indexOf(".net")>-1&&(e=e.replace(".net.","")),e.indexOf(".org")>-1&&(e=e.replace(".org","")),e.length>20&&(e=e.substring(0,20)),e},f_mod_content:function(e){var t=e.replace(/(http(s)*\:\/\/[^\s]+\s*)/g,'<a href="$1">$1</a>').replace(/#([^\s]+)/g,'<a href="//twitter.com/search?q=%23$1">#$1</a>').replace(/@([^\s:]+)/g,'<a href="//twitter.com/$1">@$1</a>');return t},f_pretty_date:function(e){try{var t=new Array;t[0]="Jan",t[1]="Feb",t[2]="Mar",t[3]="Apr",t[4]="May",t[5]="Jun",t[6]="Jul",t[7]="Aug",t[8]="Sep",t[9]="Oct",t[10]="Nov",t[11]="Dec",t[12]="December",e+="";var i=new Date(parseInt(e.trim())||""),s=((new Date).getTime()-i.getTime())/1e3,a=Math.floor(s/86400);if(isNaN(a)||0>a)return;var n=0==a&&(60>s&&"just now"||120>s&&"1m"||3600>s&&Math.floor(s/60)+"m"||7200>s&&"1h"||86400>s&&Math.floor(s/3600)+"h")||a>=1&&a+"d";return n}catch(r){console.log("error inside the f_pretty_data function: "+r)}},f_addspinner:function(){e("#ibm_cci-widget-js").append('<span class="ibm-spinner-small"></span>')},f_distribute:function(t){var s=this,a=e("#ibm_cci-widget-js").children(".ibm-col-1-1");i.search&&i.f_removeNodes(a);try{t.entries&&"undefined"!=t.entries&&t.entries.length>0&&(s.feed=t.entries,s.feed_length=t.entries.length||0)}catch(n){console.log("testing f_distribute: "+n)}try{if(s.feed)for(var r=0;r<s.feed_length;r++)s.feed[r].type&&"URLREF"===s.feed[r].type?s.f_attach_reso_temp(s.feed[r]):s.feed[r].type&&"TWEET"===s.feed[r].type&&s.f_attach_unro_temp(s.feed[r])}catch(n){console.log("Error logged in the DOM ready $.when: "+n)}},f_removeNodes:function(e){e.remove()},f_totalSearchCount:function(t){searchResultNode=e(".ibm_cci--sr > p"),searchResultNode.text("Results found: "+t).removeClass("ibm_cci-toggleDisplay")},f_buildtiles:function(){{var t=e(".ibm-sortable");t.find(".ibm-card")}t.imagesLoaded(function(){t.masonry({gutter:0,itemSelector:".ibm-card",transitionDuration:"10s"},!0)})},f_appendTrendinglist:function(t){var s=this;if(s.sTerms=[],s.sTerms.push(t),s.similar=[],s.difference=[],i.search){e.grep(s.sTerms[0],function(t){if(-1!==e.inArray(t,s.searchTrendingList)){if(0==s.similar.length)s.similar.push(t);else if(s.similar.length>0){if(-1!==e.inArray(t,s.similar))return!1;-1===e.inArray(t,s.similar)&&s.similar.push(t)}}else if(-1===e.inArray(t,s.searchTrendingList))if(0==s.difference.length)s.difference.push(t);else if(s.difference.length>0){if(-1!==e.inArray(t,s.difference))return!1;-1===e.inArray(t,s.difference)&&s.difference.push(t)}}),e.grep(s.difference,function(t){return-1!==e.inArray(t,s.searchTrendingList)?!1:void(-1===e.inArray(t,s.searchTrendingList)&&(s.searchTrendingList.push(t),s.differenceClone.push(s.difference)))}),s.newSearchTermList=e.map(s.difference,function(t){return{t_list:e.makeArray(t)}});var a=e(".ibm_cci__ml-li a.ibm_cci-voices-tt-text");try{for(var n=0;n<a.length;n++)for(var r=0;r<s.similar.length;r++)s.similar[r]==a[n].text&&(e(a[n]).parent().addClass("ibm_cci-clicked"),e(a[n]).siblings().addClass("ibm_cci-close"),e("#ibm_cci__ml_t-js").hasClass("ibm_cci-clicked")&&e("#ibm_cci__ml_t-js").removeClass("ibm_cci-clicked"))}catch(o){console.log("error in f_appendTrendinglist"+o)}e("#ibm_cci__ml_t-js").removeClass("ibm_cci-clicked"),s.st_attach_template(s.newSearchTermList),s.search=!1}},f_constructURL:function(t){var s=this;try{if(0===t.length)s.f_fetch_feeds().done(function(t){s.f_removeNodes(e("#ibm_cci-widget-js > span")),s.search=!0,s.totalSearchCountNum=t.entries.length,s.f_distribute(t),s.f_reTweetToggle(),e("#ibm_cci__ml_t-js").addClass("ibm_cci-clicked"),e("#ibm_cci-widget-js").masonry("reload"),setTimeout(function(){e("#ibm_cci-widget-js").masonry()},400)}),0==s.searchterms.length&&e(window).data("ajaxReq",!0);else if(t.length>0){s.filter_searchterms=[];for(var a=t.trim().split(","),n=0;n<a.length;n++)s.filter_searchterms.push(a[n]);e.grep(s.filter_searchterms,function(t){-1===e.inArray(t,s.searchterms)&&s.searchterms.push(t)}),e.unique(s.searchterms),e.ajax(s.f_url+"?callback=?",{type:"GET",dataType:"jsonp",contentType:"application/json",data:{rank:s.var_rank,noOfItems:20,filter:s.searchterms.toString()},success:function(){}}).done(function(t){var s=i;"undefined"!=t.entries&&t.entries.length>0?(s.search=!0,s.totalSearchCountNum=t.totalCount||0,s.f_totalSearchCount(s.totalSearchCountNum),s.f_distribute(t),s.f_reTweetToggle(),s.f_appendTrendinglist(e.makeArray(t.terms.split(","))),s.checkedCount=t.terms.split(",").length,s.f_removeNodes(e("#ibm_cci-widget-js > span")),e(".ibm-sortable").append(e(".ibm-card")).masonry("appended",e(".ibm-card")),setTimeout(function(){e("#ibm_cci-widget-js").masonry()},400),i.searchterms.length>0&&e(window).data("ajaxReq",!0)):0===t.entries.length&&(s.f_appendTrendinglist(e.makeArray(t.terms.split(","))),s.totalSearchCountNum=t.totalCount||0,s.f_totalSearchCount(s.totalSearchCountNum),s.f_removeNodes(e("#ibm_cci-widget-js .ibm-card")),0==i.searchterms.length&&e(window).data("ajaxReq",!1))}).fail(function(){}).always(function(){})}}catch(r){console.log("error inside f_constructURL"+r)}},f_checkSearchstatus:function(e){try{return 1==e?null:i.searchterms.toString()}catch(t){console.log("check searchStatus error: "+t)}},f_reTweetToggle:function(){try{e("#ibm_cci-widget-js ul.ibm_cci-relatedTweetContainer li").on("click","a",function(t){t.preventDefault();var i=e(this);parent_dataID=i.parent().data("userid"),targetDiv=i.parentsUntil("div.ibm-col-1-1").children('div[data-userid="'+parent_dataID+'"]'),i.children("img").hasClass("selected")||(i.parent("li").siblings("li").find("a img").removeClass("selected"),i.children("img").addClass("selected"),i.parentsUntil("div.ibm-col-1-1").children("div").css("display","none"),targetDiv.css("display","visible"),e(".ibm-sortable").masonry("reload"))})}catch(t){console.log("error in f_reTweetToggle function: "+t)}},f_checkBrowserWidth:function(){var t=i,s=(window.innerWidth,window.location.hash,t.f_calculateFluidMargin());0!==s?s-=10:0===s&&(s+=150),"#voices-grid"===window.location.hash&&window.innerWidth>1280&&(e("#ibm_cci-widget-js.ibm-columns").css("margin-left",s),e("#ibm_cci-widget-js.ibm-columns").css("width","auto"))},f_calculateFluidMargin:function(){var t=e("#ibm_cci-widget-js").outerWidth(!0);return t%320/2}};t.vo=i}(jQuery,window),function(e,t){"use strict";var i,s=t.event;s.special.smartresize={setup:function(){t(this).bind("resize",s.special.smartresize.handler)},teardown:function(){t(this).unbind("resize",s.special.smartresize.handler)},handler:function(e,t){var a=this,n=arguments;e.type="smartresize",i&&clearTimeout(i),i=setTimeout(function(){s.dispatch.apply(a,n)},"execAsap"===t?0:100)}},t.fn.smartresize=function(e){return e?this.bind("smartresize",e):this.trigger("smartresize",["execAsap"])},t.Mason=function(e,i){this.element=t(i),this._create(e),this._init()},t.Mason.settings={isResizable:!0,isAnimated:!1,animationOptions:{queue:!1,duration:500},gutterWidth:0,isRTL:!1,isFitWidth:!1,containerStyle:{position:"relative"}},t.Mason.prototype={_filterFindBricks:function(e){var t=this.options.itemSelector;return t?e.filter(t).add(e.find(t)):e},_getBricks:function(e){var t=this._filterFindBricks(e).css({position:"absolute"}).addClass("masonry-brick");return t},_create:function(i){this.options=t.extend(!0,{},t.Mason.settings,i),this.styleQueue=[];var s=this.element[0].style;this.originalStyle={height:s.height||""};var a=this.options.containerStyle;for(var n in a)this.originalStyle[n]=s[n]||"";this.element.css(a),this.horizontalDirection=this.options.isRTL?"right":"left";var r=this.element.css("padding-"+this.horizontalDirection),o=this.element.css("padding-top");this.offset={x:r?parseInt(r,10):0,y:o?parseInt(o,10):0},this.isFluid=this.options.columnWidth&&"function"==typeof this.options.columnWidth;var c=this;setTimeout(function(){c.element.addClass("masonry")},0),this.options.isResizable&&t(e).bind("smartresize.masonry",function(){c.resize()}),this.reloadItems()},_init:function(e){this._getColumns(),this._reLayout(e)},option:function(e){t.isPlainObject(e)&&(this.options=t.extend(!0,this.options,e))},layout:function(e,t){for(var i=0,s=e.length;s>i;i++)this._placeBrick(e[i]);var a={};if(a.height=Math.max.apply(Math,this.colYs),this.options.isFitWidth){var n=0;for(i=this.cols;--i&&0===this.colYs[i];)n++;a.width=(this.cols-n)*this.columnWidth-this.options.gutterWidth}this.styleQueue.push({$el:this.element,style:a});var r,o=this.isLaidOut&&this.options.isAnimated?"animate":"css",c=this.options.animationOptions;for(i=0,s=this.styleQueue.length;s>i;i++)r=this.styleQueue[i],r.$el[o](r.style,c);this.styleQueue=[],t&&t.call(e),this.isLaidOut=!0},_getColumns:function(){var e=this.options.isFitWidth?this.element.parent():this.element,t=e.width();this.columnWidth=this.isFluid?this.options.columnWidth(t):this.options.columnWidth||this.$bricks.outerWidth(!0)||t,this.columnWidth+=this.options.gutterWidth,this.cols=Math.floor((t+this.options.gutterWidth)/this.columnWidth),this.cols=Math.max(this.cols,1)},_placeBrick:function(e){var i,s,a,n,r,o=t(e);if(i=Math.ceil(o.outerWidth(!0)/this.columnWidth),i=Math.min(i,this.cols),1===i)a=this.colYs;else for(s=this.cols+1-i,a=[],r=0;s>r;r++)n=this.colYs.slice(r,r+i),a[r]=Math.max.apply(Math,n);for(var c=Math.min.apply(Math,a),l=0,d=0,m=a.length;m>d;d++)if(a[d]===c){l=d;break}var h={top:c+this.offset.y};h[this.horizontalDirection]=this.columnWidth*l+this.offset.x,this.styleQueue.push({$el:o,style:h});var f=c+o.outerHeight(!0),_=this.cols+1-m;for(d=0;_>d;d++)this.colYs[l+d]=f},resize:function(){var e=this.cols;this._getColumns(),(this.isFluid||this.cols!==e)&&this._reLayout()},_reLayout:function(e){var t=this.cols;for(this.colYs=[];t--;)this.colYs.push(0);this.layout(this.$bricks,e)},reloadItems:function(){this.$bricks=this._getBricks(this.element.children())},reload:function(e){this.reloadItems(),this._init(e)},appended:function(e,t,i){if(t){this._filterFindBricks(e).css({top:this.element.height()});var s=this;setTimeout(function(){s._appended(e,i)},1)}else this._appended(e,i)},_appended:function(e,t){var i=this._getBricks(e);this.$bricks=this.$bricks.add(i),this.layout(i,t)},remove:function(e){this.$bricks=this.$bricks.not(e),e.remove()},destroy:function(){this.$bricks.removeClass("masonry-brick").each(function(){this.style.position="",this.style.top="",this.style.left=""});var i=this.element[0].style;for(var s in this.originalStyle)i[s]=this.originalStyle[s];this.element.unbind(".masonry").removeClass("masonry").removeData("masonry"),t(e).unbind(".masonry")}},t.fn.imagesLoaded=function(e){function i(){e.call(a,n)}function s(e){var a=e.target;a.src!==o&&-1===t.inArray(a,c)&&(c.push(a),--r<=0&&(setTimeout(i),n.unbind(".imagesLoaded",s)))}var a=this,n=a.find("img").add(a.filter("img")),r=n.length,o="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",c=[];return r||i(),n.bind("load.imagesLoaded error.imagesLoaded",s).each(function(){var e=this.src;this.src=o,this.src=e}),a};var a=function(t){e.console&&e.console.error(t)};t.fn.masonry=function(e){if("string"==typeof e){var i=Array.prototype.slice.call(arguments,1);this.each(function(){var s=t.data(this,"masonry");return s?t.isFunction(s[e])&&"_"!==e.charAt(0)?void s[e].apply(s,i):void a("no such method '"+e+"' for masonry instance"):void a("cannot call methods on masonry prior to initialization; attempted to call method '"+e+"'")})}else this.each(function(){var i=t.data(this,"masonry");i?(i.option(e||{}),i._init()):t.data(this,"masonry",new t.Mason(e,this))});return this}}(window,jQuery,vo);