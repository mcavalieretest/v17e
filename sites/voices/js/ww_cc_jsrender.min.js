$(function(){function e(e,t){return e.indexOf("youtube")>-1&&(e=t),e}function t(e){var t="";return t=e.length>172?e.substring(0,170):e}window.location.hash="#voices-"+$("#ibm_cci--toggle-js li a").attr("id");var i=function(e){window.location.hash||null!=window.location.hash?window.location.hash="#voices-"+e:$(location).attr("hash")+"#voices-"+e};$("ul.ibm_cci--ls--toggle--ul li").on("click","a",function(e){e.preventDefault();var t=$(e.target),s=$("#ibm_cci-widget-js");t.hasClass("selected")||(t.addClass("selected").parent().siblings().children().removeClass("selected"),s.hasClass("ibm_cci-gv__modifier")?(s.removeClass("ibm_cci-gv__modifier").addClass("ibm_cci-lv__modifier"),$(".ibm_cci-lv__modifier .ibm_cci--tweet-content-text").css("display","block"),$(".ibm_cci-lv__modifier .ibm-video").css("display","none"),s.masonry("reload")):(s.removeClass("ibm_cci-lv__modifier").addClass("ibm_cci-gv__modifier"),$(".ibm_cci-gv__modifier .ibm_cci--tweet-content-text").css("display","none"),$(".ibm_cci-gv__modifier .ibm-video").removeAttr("style"),s.masonry("reloadItems"),setTimeout(function(){s.masonry()},800))),i(t.attr("id"))}),vo.init_t({tt_url:"https://esl002.somerslab.ibm.com/social/aggregator/rest/80/VOICES/trending",t_template:$("#tt_template"),t_container:$("#ibm_cci__ml")}),vo.init_f({f_url:"https://esl002.somerslab.ibm.com/social/aggregator/rest/80/VOICES",f_container:$("#ibm_cci-widget-js"),f_unro_template:$("#unro_template"),f_reso_template:$("#reso_template")}),$.when(vo.f_fetch_trending(),vo.f_fetch_feeds()).done(function(e,t){var i=vo;i.f_distribute(t),vo.f_buildtiles(),vo.f_removeNodes($("#ibm_cci-widget-js > span")),$("form").on("submit",function(){var e=$("#ibm-cc-search--field");searchVal=$("#ibm-cc-search--field").val().toLowerCase(),searchVal=searchVal.split(",");for(var t=searchVal.length-1;t>=0;t--)searchVal[t]=searchVal[t].trim();e.val(""),vo.f_constructURL(searchVal.toString())}),$("li.ibm_cci__ml_t a[name='all']").on("click",function(e){e.preventDefault(),$("p#ibm_cci__ml_t-js").hasClass("ibm_cci-clicked")||($("li.ibm_cci__ml-li p a").removeClass("ibm_cci-close-black, ibm_cci-close"),$("li.ibm_cci__ml-li p[class='ibm_cci-clicked']").removeClass("ibm_cci-clicked"),$("p#ibm_cci__ml_t-js").addClass("ibm_cci-clicked"),$(".ibm_cci--sr > p").addClass("ibm_cci-toggleDisplay"),vo.f_removeNodes($(".ibm_cci-tsearch-js")),vo.difference=[],vo.similar=[],vo.searchterms=[],vo.sTerms=[],vo.searchTrendingList=vo.searchTrendingList.slice(0,11),vo.checkedCount=0,vo.f_fetch_feeds().done(function(e){vo.f_removeNodes($("#ibm_cci-widget-js > span"));var t=e;vo.search=!0,vo.f_distribute(t),vo.reTweetToggle(),$(".ibm-sortable").append($(".ibm-card")).masonry("appended",$(".ibm-card")),setTimeout(function(){$("#ibm_cci-widget-js").masonry()},400),0==vo.searchterms.length&&$(window).data("ajaxReq",!0)}))}),$(".ibm_cci__ml-li").on("click",function(e){vo.f_addspinner();var t=$(e.target).attr("name").trim(),i=$(e.target).parent();$(i).hasClass("ibm_cci-clicked")?$(i).hasClass("ibm_cci-clicked")&&($(e.target).hasClass("ibm_cci-close-black")||($(e.target).parent("p").removeClass("ibm_cci-clicked"),$(e.target).hasClass("ibm_cci-close")?$(e.target).removeClass("ibm_cci-close"):$(e.target).siblings("a").removeClass("ibm_cci-close"),vo.searchterms=$.grep(vo.searchterms,function(e){return e!=t||null}),vo.difference=[],vo.similar=[],$(".ibm_cci--sr > p").addClass("ibm_cci-toggleDisplay"),vo.f_constructURL(vo.searchterms.toString()))):($(e.target).parent("p").addClass("ibm_cci-clicked"),$(e.target).siblings("a").addClass("ibm_cci-close"),$("#ibm_cci__ml_t-js").removeClass("ibm_cci-clicked"),vo.f_constructURL(t.toString()))}),$(".ibm_cci__ml").on("click",".ibm_cci__ml-li.ibm_cci-tsearch-js",function(e){if($(e.target).hasClass("ibm_cci-close-black")||$(e.target).hasClass("ibm_cci-voices-search-term")){var t=$(e.target).attr("name").trim();vo.searchterms=$.grep(vo.searchterms,function(e){return e!=t||null}),vo.searchTrendingList=$.grep(vo.searchTrendingList,function(e){return e!=t||null}),$(".ibm_cci--sr > p").addClass("ibm_cci-toggleDisplay"),vo.f_removeNodes($(e.target).parent().parent("li.ibm_cci__ml-li.ibm_cci-tsearch-js")),vo.difference=[],vo.similar=[],vo.search=!0,vo.f_constructURL(vo.searchterms.toString()),vo.checkedCount=0}}),vo.reTweetToggle()}),$(window).data("ajaxReq",!0).on("scroll",function(e){if(0!=$(window).data("ajaxReq"))try{{$(document).height()-900}if($(window).scrollTop()+$(window).height()>=$(document).height()-900&&$(window).data("ajaxReq",!0)){$(window).data("ajaxReq",!1);var t=$("#ibm_cci-widget-js .ibm-card").last().attr("data-rank");$.ajax({url:vo.f_url+"?callback=?",type:"GET",contentType:"application/json",dataType:"jsonp",data:{rank:t,noOfItems:20,filter:vo.f_checkSearchstatus(vo.search)},success:function(){}}).done(function(e){console.log("success"),vo.dataCards=$(".ibm-card"),e.entries&&(vo.search=!1,vo.f_distribute(e),vo.reTweetToggle(),$(".ibm-sortable").imagesLoaded(function(){console.log("masonry triggered"),$(".ibm-sortable").append($(".ibm-card")).masonry("appended",$(".ibm-card")),$(".ibm-sortable").masonry("reload")}),setTimeout(function(){e.entries.length>=20?(console.log("if Trriggered"),$(window).data("ajaxReq",!0)):$(window).data("ajaxReq",!1)},3e3))}).fail(function(){console.log("error")}).always(function(){console.log("complete")})}}catch(e){console.log("infinite all trending scroll error: "+e)}}).on("resize",function(){winHeight=$(window).height(),($(window).width()<=500||$(window).width()<=800)&&($(".ibm-sortable").imagesLoaded(function(){console.log("masonry triggered"),$(".ibm-sortable").append($(".ibm-card")).masonry("appended",$(".ibm-card")),$(".ibm-sortable").masonry("reload")}),vo.f_removeNodes($("#ibm_cci-widget-js > span"))),$(window).width()<=500&&$("#ibm_cci-widget-js").hasClass("ibm_cci-lv__modifier")&&($("#ibm_cci-widget-js").removeClass("ibm_cci-lv__modifier").addClass("ibm_cci-gv__modifier"),$(".ibm_cci--ls--toggle--li--list-icon a").removeClass("selected"),$(".ibm_cci--ls--toggle--li--grid-icon a").addClass("selected"),vo.f_removeNodes($("#ibm_cci-widget-js > span")))}),$.views.helpers({mediaURL:e,truncateDesc:t})}),function(e,t){var i={searchterms:[],differenceClone:[],searchTrendingList:[],sTerms:[],checkedCount:0,var_rank:0,search:!0,init_t:function(e){this.t_url=e.tt_url,this.t_template=e.t_template,this.t_container=e.t_container},t_attach_template:function(e){var t=e;this.t_container.append(this.t_template.render(t))},st_attach_template:function(t){var i=t;this.t_container.append(e("#st_template").render(i))},f_checkSearchstatus:function(e){console.log("inside check searchStatus");try{return 1==e?(console.log(1==e),null):i.searchterms.toString()}catch(t){console.log("check searchStatus error: "+t)}},f_fetch_trending:function(){var t=this,i=t.t_url;e.getJSON(i+"?callback=?",{type:"GET",dataType:"jsop",contentType:"application/json"},function(i){if(i&&i.trending&&i.trending.indexOf(",")>-1){var s=i.trending.trim()||null;s=e.makeArray(s),t.trendinglist=s[0].split(",")}t.t_newlist=e.map(s[0].split(","),function(t){return{t_list:e.makeArray(t)}}),t.searchTrendingList=t.trendinglist.slice(0),t.t_attach_template(t.t_newlist)}).promise()},init_f:function(e){this.f_url=e.f_url,this.f_unro_template=e.f_unro_template,this.f_container=e.f_container,this.f_reso_template=e.f_reso_template},f_attach_reso_temp:function(e){this.f_container.append(this.f_reso_template.render(this.f_modify_datafeed(e)))},f_attach_unro_temp:function(e){this.f_container.append(this.f_unro_template.render(this.f_modify_datafeed(e)))},f_modify_datafeed:function(e){var t=e||null;try{if(t&&(t.content=this.f_mod_content(t.content||""),t.published=this.f_pretty_date(t.published),t.domain=this.f_truncateDomain(t.domain||""),(t.mediaURL||t.altMediaURL)&&(t.mediaURL=this.f_preloadImages(t.mediaURL||""),t.altMediaURL=this.f_preloadImages(t.altMediaURL||"")),t.refTweets&&t.refTweets.length>0))for(var i=0;i<t.refTweets.length;i++)t.refTweets[i].content&&(t.refTweets[i].content=this.f_mod_content(t.refTweets[i].content||""),t.refTweets[i].published=this.f_pretty_date(t.refTweets[i].published||"")),(t.userAvatar||t.refTweets.userAvatar)&&(t.userAvatar=this.f_preloadImages(t.userAvatar||""),t.refTweets[i].userAvatar=this.f_preloadImages(t.refTweets[i].userAvatar||""));return t}catch(s){console.log("Error inside the modify_datafeed"+s)}},f_preloadImages:function(e){var t=new Image,i=0;return t.src=e,t.onload=function(){i=t.naturalWidth},e},f_truncateDomain:function(e){return e.indexOf(".com")>-1&&(e=e.replace(".com","")),e.indexOf("www.")>-1&&(e=e.replace("www.","")),e.indexOf(".net")>-1&&(e=e.replace(".net.","")),e.indexOf(".org")>-1&&(e=e.replace(".org","")),e.length>20&&(e=e.substring(0,20)),e},f_mod_content:function(e){var t=e.replace(/(http(s)*\:\/\/[^\s]+\s*)/g,'<a href="$1">$1</a>').replace(/#([^\s]+)/g,'<a href="//twitter.com/search?q=%23$1">#$1</a>').replace(/@([^\s:]+)/g,'<a href="//twitter.com/$1">@$1</a>');return t},f_pretty_date:function(e){try{var t=new Array;t[0]="Jan",t[1]="Feb",t[2]="Mar",t[3]="Apr",t[4]="May",t[5]="Jun",t[6]="Jul",t[7]="Aug",t[8]="Sep",t[9]="Oct",t[10]="Nov",t[11]="Dec",t[12]="December",e+="";var i=new Date(parseInt(e.trim())||""),s=((new Date).getTime()-i.getTime())/1e3,a=Math.floor(s/86400);if(isNaN(a)||0>a)return;var r=0==a&&(60>s&&"just now"||120>s&&"1m"||3600>s&&Math.floor(s/60)+"m"||7200>s&&"1h"||86400>s&&Math.floor(s/3600)+"h")||a>=1&&a+"d";return r}catch(n){console.log("error inside the f_pretty_data function: "+n)}},f_addspinner:function(){e("#ibm_cci-widget-js").append('<span class="ibm-spinner-small"></span>')},f_fetch_feeds:function(){var t=this,i=t.f_url;return t.f_addspinner(),e.ajax({url:i+"?callback=?",type:"GET",contentType:"application/json",dataType:"jsonp",data:{rank:t.var_rank,noOfItems:40,filter:t.searchterms.toString()||null}}).promise()},f_distribute:function(t){var s=this;s.widgetNodes=e("#ibm_cci-widget-js").children(".ibm-col-1-1"),i.search&&i.f_removeNodes(s.widgetNodes);try{t.entries?(s.feed=t.entries,s.feed_length=t.entries.length||0):(s.feed=t[0].entries,s.feed_length=t[0].entries.length||0)}catch(a){console.log("testing f_distribute"+a)}try{if(s.feed)for(var r=0;r<s.feed_length;r++)s.feed[r].type&&"URLREF"===s.feed[r].type?s.f_attach_reso_temp(s.feed[r]):s.feed[r].type&&"TWEET"===s.feed[r].type&&s.f_attach_unro_temp(s.feed[r])}catch(a){console.log("Error logged in the DOM ready $.when"+a)}},f_removeNodes:function(e){e.remove()},f_totalSearchCount:function(t){var i=e(".ibm_cci--sr > p");i.text("Results found: "+t).removeClass("ibm_cci-toggleDisplay")},f_buildtiles:function(){{var t=e(".ibm-sortable");t.find(".ibm-card")}t.imagesLoaded(function(){t.masonry({gutter:0,itemSelector:".ibm-card",transitionDuration:"7s"},!0)})},f_appendTrendinglist:function(t){var s=this;if(s.sTerms=[],s.sTerms.push(t),s.similar=[],s.difference=[],i.search){e.grep(s.sTerms[0],function(t){if(-1!==e.inArray(t,s.searchTrendingList)){if(0==s.similar.length)s.similar.push(t);else if(s.similar.length>0){if(-1!==e.inArray(t,s.similar))return!1;-1===e.inArray(t,s.similar)&&s.similar.push(t)}}else if(-1===e.inArray(t,s.searchTrendingList))if(0==s.difference.length)s.difference.push(t);else if(s.difference.length>0){if(-1!==e.inArray(t,s.difference))return!1;-1===e.inArray(t,s.difference)&&s.difference.push(t)}}),e.grep(s.difference,function(t){return-1!==e.inArray(t,s.searchTrendingList)?!1:void(-1===e.inArray(t,s.searchTrendingList)&&(s.searchTrendingList.push(t),s.differenceClone.push(s.difference)))}),s.newSearchTermList=e.map(s.difference,function(t){return{t_list:e.makeArray(t)}});var a=e(".ibm_cci__ml-li a.ibm_cci-voices-tt-text");try{for(var r=0;r<a.length;r++)for(var n=0;n<s.similar.length;n++)s.similar[n]==a[r].text&&(e(a[r]).parent().addClass("ibm_cci-clicked"),e(a[r]).siblings().addClass("ibm_cci-close"),e("#ibm_cci__ml_t-js").hasClass("ibm_cci-clicked")&&e("#ibm_cci__ml_t-js").removeClass("ibm_cci-clicked"))}catch(o){console.log("error in f_appendTrendinglist"+o)}e("#ibm_cci__ml_t-js").removeClass("ibm_cci-clicked"),s.st_attach_template(s.newSearchTermList),s.search=!1}},f_constructURL:function(t){var s=this;console.log(t),s.filter_searchterms=[];for(var a=t.trim().split(","),r=0;r<a.length;r++)s.filter_searchterms.push(a[r]);e.grep(s.filter_searchterms,function(t){-1===e.inArray(t,s.searchterms)&&s.searchterms.push(t)}),e.unique(s.searchterms),e.ajax(s.f_url+"?callback=?",{type:"GET",dataType:"jsonp",contentType:"application/json",data:{rank:s.var_rank,noOfItems:20,filter:s.searchterms.toString()},success:function(){}}).done(function(t){var s=i;if(s.fetchedDataArray=e(window).data("vofeed",t),console.log(s.fetchedDataArray),t.terms){if(!(t.terms.length>0))return;i.search=!0,i.f_distribute(t),i.reTweetToggle(),i.totalSearchCountNum=t.totalCount||0,i.f_totalSearchCount(t.totalCount),i.f_appendTrendinglist(e.makeArray(t.terms.split(","))),i.checkedCount=t.terms.split(",").length,i.f_removeNodes(e("#ibm_cci-widget-js > span")),e(".ibm-sortable").append(e(".ibm-card")).masonry("appended",e(".ibm-card")),setTimeout(function(){e("#ibm_cci-widget-js").masonry()},400),i.searchterms.length>0&&e(window).data("ajaxReq",!0)}else i.f_fetch_feeds().done(function(t){i.f_removeNodes(e("#ibm_cci-widget-js > span")),i.search=!0,i.f_distribute(t),i.reTweetToggle(),e("#ibm_cci__ml_t-js").addClass("ibm_cci-clicked"),e("#ibm_cci-widget-js").masonry("reload"),setTimeout(function(){e("#ibm_cci-widget-js").masonry()},400)}),0==i.searchterms.length&&e(window).data("ajaxReq",!0)}).fail(function(){console.log("error")}).always(function(){console.log("complete")})},reTweetToggle:function(){try{e("#ibm_cci-widget-js ul.ibm_cci-relatedTweetContainer li").on("click","a",function(t){t.preventDefault();var i=e(this);parent_dataID=i.parent().data("userid"),targetDiv=i.parentsUntil("div.ibm-col-1-1").children('div[data-userid="'+parent_dataID+'"]'),i.children("img").hasClass("selected")||(i.parent("li").siblings("li").find("a img").removeClass("selected"),i.children("img").addClass("selected"),i.parentsUntil("div.ibm-col-1-1").children("div").css("display","none"),targetDiv.css("display","visible"),e(".ibm-sortable").masonry("reload"))})}catch(t){console.log("error in reTweetToggle function: "+t)}}};t.vo=i}(jQuery,window),function(e,t){"use strict";var i,s=t.event;s.special.smartresize={setup:function(){t(this).bind("resize",s.special.smartresize.handler)},teardown:function(){t(this).unbind("resize",s.special.smartresize.handler)},handler:function(e,t){var a=this,r=arguments;e.type="smartresize",i&&clearTimeout(i),i=setTimeout(function(){s.dispatch.apply(a,r)},"execAsap"===t?0:100)}},t.fn.smartresize=function(e){return e?this.bind("smartresize",e):this.trigger("smartresize",["execAsap"])},t.Mason=function(e,i){this.element=t(i),this._create(e),this._init()},t.Mason.settings={isResizable:!0,isAnimated:!1,animationOptions:{queue:!1,duration:500},gutterWidth:0,isRTL:!1,isFitWidth:!1,containerStyle:{position:"relative"}},t.Mason.prototype={_filterFindBricks:function(e){var t=this.options.itemSelector;return t?e.filter(t).add(e.find(t)):e},_getBricks:function(e){var t=this._filterFindBricks(e).css({position:"absolute"}).addClass("masonry-brick");return t},_create:function(i){this.options=t.extend(!0,{},t.Mason.settings,i),this.styleQueue=[];var s=this.element[0].style;this.originalStyle={height:s.height||""};var a=this.options.containerStyle;for(var r in a)this.originalStyle[r]=s[r]||"";this.element.css(a),this.horizontalDirection=this.options.isRTL?"right":"left";var n=this.element.css("padding-"+this.horizontalDirection),o=this.element.css("padding-top");this.offset={x:n?parseInt(n,10):0,y:o?parseInt(o,10):0},this.isFluid=this.options.columnWidth&&"function"==typeof this.options.columnWidth;var c=this;setTimeout(function(){c.element.addClass("masonry")},0),this.options.isResizable&&t(e).bind("smartresize.masonry",function(){c.resize()}),this.reloadItems()},_init:function(e){this._getColumns(),this._reLayout(e)},option:function(e){t.isPlainObject(e)&&(this.options=t.extend(!0,this.options,e))},layout:function(e,t){for(var i=0,s=e.length;s>i;i++)this._placeBrick(e[i]);var a={};if(a.height=Math.max.apply(Math,this.colYs),this.options.isFitWidth){var r=0;for(i=this.cols;--i&&0===this.colYs[i];)r++;a.width=(this.cols-r)*this.columnWidth-this.options.gutterWidth}this.styleQueue.push({$el:this.element,style:a});var n,o=this.isLaidOut&&this.options.isAnimated?"animate":"css",c=this.options.animationOptions;for(i=0,s=this.styleQueue.length;s>i;i++)n=this.styleQueue[i],n.$el[o](n.style,c);this.styleQueue=[],t&&t.call(e),this.isLaidOut=!0},_getColumns:function(){var e=this.options.isFitWidth?this.element.parent():this.element,t=e.width();this.columnWidth=this.isFluid?this.options.columnWidth(t):this.options.columnWidth||this.$bricks.outerWidth(!0)||t,this.columnWidth+=this.options.gutterWidth,this.cols=Math.floor((t+this.options.gutterWidth)/this.columnWidth),this.cols=Math.max(this.cols,1)},_placeBrick:function(e){var i,s,a,r,n,o=t(e);if(i=Math.ceil(o.outerWidth(!0)/this.columnWidth),i=Math.min(i,this.cols),1===i)a=this.colYs;else for(s=this.cols+1-i,a=[],n=0;s>n;n++)r=this.colYs.slice(n,n+i),a[n]=Math.max.apply(Math,r);for(var c=Math.min.apply(Math,a),l=0,d=0,m=a.length;m>d;d++)if(a[d]===c){l=d;break}var h={top:c+this.offset.y};h[this.horizontalDirection]=this.columnWidth*l+this.offset.x,this.styleQueue.push({$el:o,style:h});var f=c+o.outerHeight(!0),_=this.cols+1-m;for(d=0;_>d;d++)this.colYs[l+d]=f},resize:function(){var e=this.cols;this._getColumns(),(this.isFluid||this.cols!==e)&&this._reLayout()},_reLayout:function(e){var t=this.cols;for(this.colYs=[];t--;)this.colYs.push(0);this.layout(this.$bricks,e)},reloadItems:function(){this.$bricks=this._getBricks(this.element.children())},reload:function(e){this.reloadItems(),this._init(e)},appended:function(e,t,i){if(t){this._filterFindBricks(e).css({top:this.element.height()});var s=this;setTimeout(function(){s._appended(e,i)},1)}else this._appended(e,i)},_appended:function(e,t){var i=this._getBricks(e);this.$bricks=this.$bricks.add(i),this.layout(i,t)},remove:function(e){this.$bricks=this.$bricks.not(e),e.remove()},destroy:function(){this.$bricks.removeClass("masonry-brick").each(function(){this.style.position="",this.style.top="",this.style.left=""});var i=this.element[0].style;for(var s in this.originalStyle)i[s]=this.originalStyle[s];this.element.unbind(".masonry").removeClass("masonry").removeData("masonry"),t(e).unbind(".masonry")}},t.fn.imagesLoaded=function(e){function i(){e.call(a,r)}function s(e){var a=e.target;a.src!==o&&-1===t.inArray(a,c)&&(c.push(a),--n<=0&&(setTimeout(i),r.unbind(".imagesLoaded",s)))}var a=this,r=a.find("img").add(a.filter("img")),n=r.length,o="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",c=[];return n||i(),r.bind("load.imagesLoaded error.imagesLoaded",s).each(function(){var e=this.src;this.src=o,this.src=e}),a};var a=function(t){e.console&&e.console.error(t)};t.fn.masonry=function(e){if("string"==typeof e){var i=Array.prototype.slice.call(arguments,1);this.each(function(){var s=t.data(this,"masonry");return s?t.isFunction(s[e])&&"_"!==e.charAt(0)?void s[e].apply(s,i):void a("no such method '"+e+"' for masonry instance"):void a("cannot call methods on masonry prior to initialization; attempted to call method '"+e+"'")})}else this.each(function(){var i=t.data(this,"masonry");i?(i.option(e||{}),i._init()):t.data(this,"masonry",new t.Mason(e,this))});return this}}(window,jQuery,vo);